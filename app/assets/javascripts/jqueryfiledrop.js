(function(e){function a(e){t.drop(e);u=e.dataTransfer.files;if(u===null||u===undefined){t.error(r[0]);return false}o=u.length;c();e.preventDefault();return false}function f(n,r,i){var s="--",o="\r\n",u="";e.each(t.data,function(e,t){if(typeof t==="function")t=t();u+=s;u+=i;u+=o;u+='Content-Disposition: form-data; name="'+e+'"';u+=o;u+=o;u+=t;u+=o});u+=s;u+=i;u+=o;u+='Content-Disposition: form-data; name="'+t.paramname+'"';u+='; filename="'+n+'"';u+=o;u+="Content-Type: application/octet-stream";u+=o;u+=o;u+=r;u+=o;u+=s;u+=i;u+=s;u+=o;return u}function l(e){if(e.lengthComputable){var n=Math.round(e.loaded*100/e.total);if(this.currentProgress!=n){this.currentProgress=n;t.progressUpdated(this.index,this.file,this.currentProgress);var r=(new Date).getTime();var i=r-this.currentStart;if(i>=t.refresh){var s=e.loaded-this.startData;var o=s/i;t.speedUpdated(this.index,this.file,o);this.startData=e.loaded;this.currentStart=r}}}}function c(){function y(r){if(r.target.index==undefined){r.target.index=h(r.total)}var a=new XMLHttpRequest,c=a.upload,d=u[r.target.index],m=r.target.index,g=(new Date).getTime(),y="------multipartformboundary"+(new Date).getTime(),b;newName=p(d.name);if(typeof newName==="string"){b=f(newName,r.target.result,y)}else{b=f(d.name,r.target.result,y)}c.index=m;c.file=d;c.downloadStartTime=g;c.currentStart=g;c.currentProgress=0;c.startData=0;c.addEventListener("progress",l,false);a.open("POST",t.url,true);a.setRequestHeader("content-type","multipart/form-data; boundary="+y);csrf=e("#csrf").text();if(csrf){a.setRequestHeader("x-csrf-token",csrf)}a.sendAsBinary(b);t.uploadStarted(m,d,o);a.onload=function(){if(a.responseText){var e=(new Date).getTime(),r=e-g,u=t.uploadFinished(m,d,jQuery.parseJSON(a.responseText),r);n++;if(n==o-i){v()}if(u===false)s=true}}}s=false;if(!u){t.error(r[0]);return false}var n=0,i=0;if(o>t.maxfiles){t.error(r[1]);return false}for(var a=0;a<o;a++){if(s)return false;try{if(d(u[a])!=false){if(a===o)return;var c=new FileReader,m=1048576*t.maxfilesize;c.index=a;if(u[a].size>m){t.error(r[2],u[a],a);i++;continue}c.onloadend=y;c.readAsBinaryString(u[a])}else{i++}}catch(g){t.error(r[0]);return false}}}function h(e){for(var t=0;t<o;t++){if(u[t].size==e){return t}}return undefined}function p(e){return t.rename(e)}function d(e){return t.beforeEach(e)}function v(){return t.afterAll()}function m(e){clearTimeout(i);e.preventDefault();t.dragEnter(e)}function g(e){clearTimeout(i);e.preventDefault();t.docOver(e);t.dragOver(e)}function y(e){clearTimeout(i);t.dragLeave(e);e.stopPropagation()}function b(e){e.preventDefault();t.docLeave(e);return false}function w(e){clearTimeout(i);e.preventDefault();t.docEnter(e);return false}function E(e){clearTimeout(i);e.preventDefault();t.docOver(e);return false}function S(e){i=setTimeout(function(){t.docLeave(e)},200)}function x(){}jQuery.event.props.push("dataTransfer");var t={},n={url:"",refresh:1e3,paramname:"userfile",maxfiles:25,maxfilesize:1,data:{},drop:x,dragEnter:x,dragOver:x,dragLeave:x,docEnter:x,docOver:x,docLeave:x,beforeEach:x,afterAll:x,rename:x,error:function(e,t,n){alert(e)},uploadStarted:x,uploadFinished:x,progressUpdated:x,speedUpdated:x},r=["BrowserNotSupported","TooManyFiles","FileTooLarge"],i,s=false,o=0,u;e.fn.filedrop=function(r){t=e.extend({},n,r);this.bind("drop",a).bind("dragenter",m).bind("dragover",g).bind("dragleave",y);e(document).bind("drop",b).bind("dragenter",w).bind("dragover",E).bind("dragleave",S)};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return e.charCodeAt(0)&255}var n=Array.prototype.map.call(e,t);var r=new Uint8Array(n);this.send(r.buffer)}}catch(T){}})(jQuery)